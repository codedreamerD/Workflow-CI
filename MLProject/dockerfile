FROM continuumio/miniconda3

# Copy and install environment
COPY MLProject/conda.yml /tmp/conda.yml
RUN conda env create -f /tmp/conda.yml && conda clean -afy

# Activate environment
SHELL ["conda", "run", "-n", "mlflow-env", "/bin/bash", "-c"]

# Set working directory
WORKDIR /app

# Copy files
COPY MLProject /app

# Expose MLflow UI port (opsional)
EXPOSE 5000

# Jalankan ML pipeline (DAGSHUB tracking sudah diatur dari dalam modelling.py)
CMD ["conda", "run", "-n", "mlflow-env", "python", "modelling.py"]