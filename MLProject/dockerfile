FROM continuumio/miniconda3

# Install MLflow
RUN conda install -y -c conda-forge mlflow

# Copy conda environment
COPY conda.yml /tmp/conda.yml
RUN conda env create -f /tmp/conda.yml && conda clean -afy

# Update path
ENV PATH=/opt/conda/envs/mlflow-env/bin:$PATH

# Set working directory
WORKDIR /app

# Copy project files
COPY . /app

# Expose port for MLflow local
EXPOSE 5000

# Jalankan MLflow tracking server (background) + modelling
CMD mlflow server --host 0.0.0.0 --port 5000 & python modelling.py && tail -f /dev/null